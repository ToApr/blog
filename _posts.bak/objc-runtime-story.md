点赞的一定是完全读懂了

# 背景

KT是代码王国的第1024任国王，此人极好女色，号称后宫佳丽三千。按照旧的规则，每晚侍寝的人选由内侍监统一统筹安排，妃子们往往提前数周就可以得知自己具体的侍寝日期。国王KT对这种制度不满已久，他觉得这是一种非常死板的方法，无法处理各种突发情况，缺少灵活性。机智的他想出了一个新的方法：记录每个妃子的名字，然后每晚由自己选择，临时决定由哪一位妃子侍寝，而后召来太监小凳子，宣被选中的妃子前来侍寝。至于小凳子，他得知了国王的选择后，会到内侍监的名册中，根据妃子的名字找到她的住所，然后前往那里宣妃子侍寝。

# 小凳子的烦恼

国王十分喜欢这种新的制度，只是之前说过，国王号称后宫佳丽三千，实际上可能更是远远不止这个数。这可苦了小凳子，他得在厚厚一摞名册中找到妃子的名字，运气不好的时候过了子时也找不到，国王早就等的不耐烦了。代码王国中每个人都很聪明，小凳子想了一个点子：他把经常被国王宠幸的妃子的名字单独列了一份名单，大约有几十人。这样一来，大部分时候他只要在这名单中找就可以了。

有时候，小凳子找遍了名册也没找到被宣的妃子的名字。这是因为小凳子的师傅那里也有一份名册，虽然这两份名册很多内容是一样的，但总有一些微小的差别。所以如果小凳子找不到妃子的名字的时候就会去向他师傅求助。他师傅也很聪明，也会先从自己单独列出的一小份名单中找，如果找不到才会在厚名册中找。如果师傅也找不到，他还会找他自己的师傅，也就是小凳子的师公。

万幸的是，在小凳子的师傅的师傅的……师傅那里，妃子的名字终于被找到了。小凳子当然记得这次惨痛的教训，他把这个妃子的名字也加入到那一小份名册中，毕竟国王再次选这个妃子的几率还是挺大的。小凳子的师傅可不管这事儿，毕竟国王找的是小凳子又不是自己。如果真有哪天国王召见自己办这差事，那到时候记录也不迟。

# 危机来临

在自己的机智和师傅师祖们的合力帮助下，小凳子有惊无险的完成了多次任务。只是突然有一天，国王让他去宣一名叫“闹特芳德”的妃子。小凳子一开始没有把这事放在心上，因为同样的任务他已经完成了无数次。只是这一次，不仅小册子中找不到“闹特芳德”的信息，完整的名册里也没有。甚至他的祖师爷也告诉他，师门上下找了个遍，都没有这位妃子的信息。事实上他们当然找不到，因为这位“闹特芳德”姑娘已经在数年前染病身亡，她的相关信息都已被抹去。

无奈之下小凳子只得另辟蹊径，他首先打听了一番最近有没有新入宫的人。如果有的话他就可以用这新人代替“闹特芳德”妃子。然后把她带到国王身边。只可惜最近宫中风平浪静，并没有人新入宫。

小凳子想到了自己的好基友小卓子，小卓子人脉广，人也很机灵，说不定就有什么好点子。不仅如此，他的其他几个好基友也很有能力。于是他询问自己的朋友们：“国王委派给了我一个任务，要找一位妃子侍寝，妃子叫“闹特芳德，你们谁能帮帮我？”。”他希望能有朋友能替他完成这个任务，只可惜这事太难办，大家都无能为力。

走投无路的小凳子只好在内侍监里广发布告，布告内容主要是三点。任务执行者是小凳子，任务内容是宣妃子侍寝，具体细节是这个妃子叫“闹特芳德”。任何人都可以接这个任务，他们可以修改一下任务再完成。比如可以换一个完成者，由小卓子来完成这个任务。也可以换任务内容，比如改成宣太监侍寝。还可以修改任务细节，比如宣“闹特芳德”的表妹，“芳德”妃子。小凳子心里明白，估计换个人做任务是不太可能了，因为自己之前已经问过朋友，他们都说不能完成这件事。

其实这件事由谁来做，怎么做都不重要，重要的只要一个人站出来，说自己可以完成任务即可。小凳子也不知变通，他完全可以口头答应下来，然后找另外一个妃子去侍寝，虽然效果打了折扣但也不至于被愤怒的国王以“拒不遵旨”为罪名处死。事后看来，虽然“闹特芳德”妃子确实根本不可能找到，但小凳子至少有三次活命的机会，只可惜他一次都没把握住。

[这个项目](https://github.com/bestswifter/MySampleCode/tree/master/runtime)本可救小凳子一命，但他还未来得及学习。

# 阴谋

渐渐地，一位大臣发现国王似乎非常宠爱A妃子。于是他心生一计，先让自己的女儿B进入宫中，再将名册中A妃子的住所地址和自己女儿的地址互换。这样，太监每次去宣A妃子的时候其实去的是B的家中。B得以经常见到国王，这位大臣也打听到了很多国王的内幕消息，也因此得了不少好处。


这种瞒天过海，偷天换日的事虽然收获巨大，但也非常危险，稍有不慎就是掉脑袋的下场。这位大臣认真总结了一些要点：

1. 去内侍监改名册时一定要小心，千万不能有第二个人在场。
2. 如果名册中已经有人和自己女儿重名，这事就非常难办。
3. 换名字这事只能做一次，如果不小心做了两次，那么两次的效果完全抵消，相当于自己什么都没干。最好的方法就是确保只在建立名册的时候修改一次。
4. 必须时刻保持头脑清楚。自己的女儿名字已经在名册中了，如果国王宣了自己的女儿，那其实真正被召见去侍寝的是原来的妃子。

总的来说，这种事情是高风险高收益的，如果使用得当可以给自己带来巨大的好处，但如果使用不当，也有可能伤及自己。好在歪果仁写了一份[非常详细的教程](http://stackoverflow.com/questions/5339276/what-are-the-dangers-of-method-swizzling-in-objective-c)。
